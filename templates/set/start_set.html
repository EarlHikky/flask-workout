{% extends 'base.html' %}

{% block content %}
 {{ super() }}

 <div id="formContainer" style="display: block;">
   <form id="start-form" action="{{ url_for('add_set') }}" method="post" class="form-contact">
       <label>{{ exercise_title }}</label>
       <input type="hidden" name="exercise_id" value="{{ exercise_id }}">
       <input type="hidden" name="set_index" value="{{ current_set_index }}">
       <input type="hidden" name="workout_id" value="{{ current_workout_id }}">
       <input id="hideFormButton" type="submit" value="Старт" />
   </form>
 </div>
 <form action="{{ url_for('stop_set') }}" method="post" class="form-contact">
   <label>Повторы: </label> <input type="text" name="reps" id="reps" value="{{ reps }}" />
   <label>Вес: </label> <input type="text" name="weight" id="weight" value="{{ weight }}" />
   <label>Время: </label> <input type="text" name="duration" id="duration" value="{{ duration }}" />
     <label>Отдых: </label>
     <table>
       <tr>
         <input type="text" name="old_rest" id="old_rest" value="{{ rest }}" />
       </tr>
       <tr>
         <td>
           <div class="radio-container">
             <input type="radio" id="rest120" name="new_rest" value="120" {% if rest == '00:02:00' %}checked{% endif %}>
             <label for="rest120">120 сек</label>
           </div>
         </td>
         <td>
           <div class="radio-container">
             <input type="radio" id="rest90" name="new_rest" value="90" {% if rest == '00:01:30' %}checked{% endif %}>
             <label for="rest90">90 сек</label>
           </div>
         </td>
         <td>
           <div class="radio-container">
             <input type="radio" id="rest60" name="new_rest" value="60" {% if rest == '00:01:00' %}checked{% endif %}>
             <label for="rest60">60 сек</label>
           </div>
         </td>
         <td>
           <div class="radio-container">
             <input type="radio" id="rest30" name="new_rest" value="30" {% if rest == '00:00:30' %}checked{% endif %}>
             <label for="rest30">30 сек</label>
           </div>
         </td>
         <td>
           <div class="radio-container">
             <input type="radio" id="rest0" name="new_rest" value="30" {% if rest == '00:00:00' %}checked{% endif %}>
             <label for="rest30">0 сек</label>
           </div>
         </td>
       </tr>
     </table>
   </p>
   <p><input type="submit" value="Стоп" /></p>
 </form>
 <div id="timer-container">
    <div id="timer">{{ rest }}</div>

    <audio id="timerSound">
        <source src="{{ url_for('static', filename='alarm.mp3') }}" type="audio/mp3">
    </audio>
    <button onclick="startTimer()">Старт</button>
    <button onclick="stopTimer()">Стоп</button>
</div>

 <form action="{{url_for('stop_workout')}}" method="post" class="form-contact">
   <input type="submit" value="Завершить тренировку">
 </form>

 <script>
 const hideButton = document.querySelector('#hideFormButton');
 const showButton = document.querySelector('#showFormButton');
 const formContainer = document.querySelector('#formContainer');

 hideButton.addEventListener('click', (event) => {
   event.preventDefault();

   // Отправка формы
   const form = document.querySelector('#formContainer form');
   const formData = new FormData(form);
   fetch(form.action, {
     method: form.method,
     body: formData
   }).then(response => {
     // Скрытие формы
     formContainer.style.display = 'none';
   });
 });
 </script>

<script>
        var timer;
        var seconds = {{ rest }};

        function startTimer() {
            timer = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            seconds--;

            if (seconds <= 5) {
                playTimerSound();  // Воспроизведение звука за 5 секунд до конца таймера
            }

            if (seconds <= 0) {
                clearInterval(timer);
            }

            document.getElementById('timer').innerHTML = seconds;
        }

        function stopTimer() {
            clearInterval(timer);
        }

function playTimerSound() {
        var audio = document.getElementById('timerSound');

        // Проверяем, поддерживает ли браузер воспроизведение звука
        if (audio.canPlayType && audio.canPlayType('audio/mpeg;').replace(/no/, '')) {
            audio.play();
        } else {
            alert("Ваш браузер не поддерживает воспроизведение звука.");
        }
    }



    </script>
{% endblock %}
